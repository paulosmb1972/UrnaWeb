<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>UrnaWeb Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#0a2a66;color:white}
.screen{display:none;padding:20px;min-height:100vh}
.active{display:block}
h2,h3,h4{text-align:center}
input,button,select,textarea{
  width:100%;padding:12px;margin:6px 0;
  font-size:16px;border-radius:6px;border:none
}
button{background:#1abc9c;font-weight:bold;cursor:pointer}
.secondary{background:#f1c40f}
.danger{background:#e74c3c;color:white}
.candidate-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:10px
}
.candidate{
  background:#122f5f;border:4px solid transparent;
  border-radius:8px;padding:8px;text-align:center;cursor:pointer
}
.candidate.selected{border-color:#2ecc71}
.candidate img{width:100%;height:140px;object-fit:cover;border-radius:6px}
.lang-box{position:fixed;top:10px;right:10px}
.lang-box button{width:auto;margin-left:4px}
.result-box{background:white;color:black;padding:20px}
</style>
</head>

<body>

<div class="lang-box">
  <button onclick="setLang('pt')">ğŸ‡§ğŸ‡·</button>
  <button onclick="setLang('en')">ğŸ‡ºğŸ‡¸</button>
  <button onclick="setLang('es')">ğŸ‡ªğŸ‡¸</button>
</div>

<!-- LOGIN -->
<div id="login" class="screen active">
  <h2 id="tLogin"></h2>
  <input id="userEmail" placeholder="email@gmail.com">
  <button id="btnContinue" onclick="loginUser()"></button>
</div>

<!-- CONFIG -->
<div id="setup" class="screen">
  <h2 id="tConfig"></h2>
  <input id="electionName">
  <input id="cargoName">
  <input id="maxVotes" type="number">
  <label id="lblNames"></label>
  <input type="file" id="candidateNames" accept=".txt">
  <label id="lblPhotos"></label>
  <input type="file" id="candidatePhotos" accept="image/*" multiple>
  <button id="btnAddCargo" onclick="addCargo()"></button>
  <button id="btnStart" class="secondary" onclick="startVoting()"></button>
  <div id="cargoList"></div>
</div>

<!-- VOTAÃ‡ÃƒO -->
<div id="voting" class="screen">
  <h2 id="cargoTitle"></h2>
  <div id="candidates" class="candidate-grid"></div>
  <button id="btnConfirm" onclick="confirmVote()"></button>
</div>

<!-- CONFIRMAÃ‡ÃƒO -->
<div id="afterVote" class="screen">
  <h2 id="tConfirmed"></h2>
  <button id="btnNext" onclick="nextVoter()"></button>
  <button id="btnFinish" class="danger" onclick="finishElection()"></button>
</div>

<!-- RESULTADOS -->
<div id="results" class="screen">
  <h2 id="tResult"></h2>
  <div id="resultContent"></div>

  <button onclick="exportPDF()">ğŸ“„ Exportar PDF</button>

  <hr style="margin:20px 0">

  <button onclick="showScreen('feedback')">â­ Avaliar Sistema</button>
  <button onclick="showScreen('feedback')">ğŸ’¡ Enviar SugestÃ£o</button>
  <button onclick="showScreen('payment')">ğŸ·ï¸ Cupons</button>
  <button onclick="showScreen('payment')" class="secondary">ğŸ’³ Pagamento</button>
</div>

<!-- PAGAMENTO -->
<div id="payment" class="screen">
  <h2 id="tPlan"></h2>
  <p id="tPlanText" style="text-align:center"></p>
  <h3 style="text-align:center">R$ 15,00</h3>

  <input id="couponInput" placeholder="Cupom">
  <button onclick="applyCoupon()" class="secondary">Aplicar Cupom</button>
  <p id="couponMsg" style="text-align:center"></p>

  <button onclick="goToPayment()">Pagar</button>
</div>

<!-- FEEDBACK -->
<div id="feedback" class="screen">
  <h2>AvaliaÃ§Ã£o do Sistema</h2>

  <select id="rate">
    <option value="5">â­â­â­â­â­</option>
    <option value="4">â­â­â­â­</option>
    <option value="3">â­â­â­</option>
    <option value="2">â­â­</option>
    <option value="1">â­</option>
  </select>

  <textarea id="feedbackText" rows="5" placeholder="Digite sua sugestÃ£o ou avaliaÃ§Ã£o"></textarea>

  <button onclick="sendFeedback()">Enviar</button>
  <button class="secondary" onclick="showScreen('results')">Voltar</button>
</div>

<script>
let election={name:"",cargos:[]};
let currentCargo=0,selected=[];
let lang=localStorage.getItem("lang")||"pt";
const PAYMENT_LINK="https://mpago.la/1VakcdN";

function showScreen(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function loginUser(){
  if(!userEmail.value.endsWith("@gmail.com")){
    alert("Informe um Gmail vÃ¡lido"); return;
  }
  showScreen("setup");
}

function addCargo(){
  const cargo=cargoName.value.trim();
  const max=parseInt(maxVotes.value);
  const file=candidateNames.files[0];
  const photos=[...candidatePhotos.files];
  if(!cargo||!max||!file){alert("Preencha tudo");return;}
  const r=new FileReader();
  r.onload=()=>{
    const names=r.result.split("\n").filter(n=>n.trim());
    election.cargos.push({
      cargo,max,
      candidates:names.map((n,i)=>({name:n.trim(),photo:photos[i]?URL.createObjectURL(photos[i]):"",votes:0}))
    });
    cargoList.innerHTML+=`<p>âœ” ${cargo}</p>`;
  };
  r.readAsText(file);
}

function startVoting(){
  if(!electionName.value||!election.cargos.length){alert("Configure a eleiÃ§Ã£o");return;}
  election.name=electionName.value;
  currentCargo=0;showCargo();
}

function showCargo(){
  selected=[];showScreen("voting");
  const c=election.cargos[currentCargo];
  cargoTitle.innerText=c.cargo;
  candidates.innerHTML="";
  c.candidates.forEach((x,i)=>{
    const d=document.createElement("div");
    d.className="candidate";
    d.innerHTML=`<img src="${x.photo}"><p>${x.name}</p>`;
    d.onclick=()=>toggle(i,d);
    candidates.appendChild(d);
  });
}

function toggle(i,d){
  const c=election.cargos[currentCargo];
  if(selected.includes(i)){selected=selected.filter(x=>x!==i);d.classList.remove("selected");}
  else{if(selected.length>=c.max)return;selected.push(i);d.classList.add("selected");}
}

function confirmVote(){
  selected.forEach(i=>election.cargos[currentCargo].candidates[i].votes++);
  currentCargo<election.cargos.length-1?(currentCargo++,showCargo()):showScreen("afterVote");
}

function nextVoter(){currentCargo=0;showCargo();}

function finishElection(){
  showScreen("results");
  resultContent.innerHTML=`<h3>${election.name}</h3>`;
  election.cargos.forEach(c=>{
    resultContent.innerHTML+=`<h4>${c.cargo}</h4>`;
    c.candidates.forEach(x=>resultContent.innerHTML+=`<p>${x.name}: ${x.votes}</p>`);
  });
}

function exportPDF(){
  const box=document.createElement("div");
  box.className="result-box";
  box.innerHTML=resultContent.innerHTML;
  document.body.appendChild(box);
  html2pdf().from(box).save().then(()=>box.remove());
}

function goToPayment(){window.open(PAYMENT_LINK,"_blank");}

function applyCoupon(){
  const code=couponInput.value.trim().toUpperCase();
  couponMsg.innerText = code==="FREE5" ? "Cupom vÃ¡lido!" : "Cupom invÃ¡lido";
}

function sendFeedback(){
  alert("Obrigado pela avaliaÃ§Ã£o!");
  showScreen("results");
}

setLang(lang);
</script>

</body>
</html>
