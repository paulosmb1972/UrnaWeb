<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>UrnaWeb Pro</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#0a2a66;color:white}
.screen{display:none;padding:20px;min-height:100vh}
.active{display:block}
h2,h3,h4{text-align:center}
input,button,select,textarea{
  width:100%;padding:12px;margin:6px 0;
  font-size:16px;border-radius:6px;border:none
}
button{background:#1abc9c;font-weight:bold;cursor:pointer}
.secondary{background:#f1c40f}
.danger{background:#e74c3c;color:white}
.candidate-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:10px
}
.candidate{
  background:#122f5f;border:4px solid transparent;
  border-radius:8px;padding:8px;text-align:center;cursor:pointer
}
.candidate.selected{border-color:#2ecc71}
.candidate img{width:100%;height:140px;object-fit:cover;border-radius:6px}
.lang-box{position:fixed;top:10px;right:10px}
.lang-box button{width:auto;margin-left:4px}
.result-box{background:white;color:black;padding:20px}
</style>
</head>

<body>

<div class="lang-box">
  <button onclick="setLang('pt')">üáßüá∑</button>
  <button onclick="setLang('en')">üá∫üá∏</button>
  <button onclick="setLang('es')">üá™üá∏</button>
</div>

<div id="login" class="screen active">
  <h2 id="tLogin"></h2>
  <input id="userEmail" placeholder="email@gmail.com">
  <button id="btnContinue" onclick="loginUser()"></button>
</div>

<div id="setup" class="screen">
  <h2 id="tConfig"></h2>
  <input id="electionName">
  <input id="cargoName">
  <input id="maxVotes" type="number">
  <label id="lblNames"></label>
  <input type="file" id="candidateNames" accept=".txt">
  <label id="lblPhotos"></label>
  <input type="file" id="candidatePhotos" accept="image/*" multiple>
  <button id="btnAddCargo" onclick="addCargo()"></button>
  <button id="btnStart" class="secondary" onclick="startVoting()"></button>
  <div id="cargoList"></div>
</div>

<div id="voting" class="screen">
  <h2 id="cargoTitle"></h2>
  <div id="candidates" class="candidate-grid"></div>
  <button id="btnConfirm" onclick="confirmVote()"></button>
</div>

<div id="afterVote" class="screen">
  <h2 id="tConfirmed"></h2>
  <button id="btnNext" onclick="nextVoter()"></button>
  <button id="btnFinish" class="danger" onclick="finishElection()"></button>
</div>

<div id="results" class="screen">
  <h2 id="tResult"></h2>

  <div id="resultContent"></div>

  <button id="btnPDF" onclick="exportPDF()">üìÑ Exportar PDF</button>

  <hr style="margin:20px 0">

  <button onclick="showScreen('feedback')">‚≠ê Avaliar Sistema</button>
  <button onclick="showScreen('feedback')">üí° Enviar Sugest√£o</button>
  <button onclick="showScreen('payment')">üè∑Ô∏è Cupons</button>
  <button onclick="showScreen('payment')" class="secondary">üí≥ Pagamento</button>
</div>

<div id="payment" class="screen">
  <h2 id="tPlan"></h2>
  <p id="tPlanText" style="text-align:center"></p>
  <h3 style="text-align:center">R$ 15,00</h3>
  <input id="couponInput" placeholder="Cupom">
  <button onclick="applyCoupon()" class="secondary">Aplicar Cupom</button>
  <p id="couponMsg" style="text-align:center"></p>
  <button onclick="goToPayment()">Pagar</button>
</div>

<script>
/* ================== SISTEMA ================== */
let election={name:"",cargos:[]};
let currentCargo=0,selected=[];
let lang=localStorage.getItem("lang")||"pt";
const PAYMENT_LINK="https://mpago.la/1VakcdN";

function showScreen(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function loginUser(){
  const email=userEmail.value.trim();
  if(!email.endsWith("@gmail.com")){
    alert(txt[lang].invalidEmail);return;
  }
  localStorage.setItem("email",email);
  showScreen("setup");
}

function addCargo(){
  const cargo=cargoName.value.trim();
  const max=parseInt(maxVotes.value);
  const file=candidateNames.files[0];
  const photos=[...candidatePhotos.files];
  if(!cargo||!max||!file){alert(txt[lang].fillAll);return;}
  const r=new FileReader();
  r.onload=()=>{
    const names=r.result.split("\n").filter(n=>n.trim());
    election.cargos.push({
      cargo,max,
      candidates:names.map((n,i)=>({
        name:n.trim(),
        photo:photos[i]?URL.createObjectURL(photos[i]):"",
        votes:0
      }))
    });
    cargoList.innerHTML+=`<p>‚úî ${cargo}</p>`;
    cargoName.value=maxVotes.value="";
  };
  r.readAsText(file,"UTF-8");
}

function startVoting(){
  election.name=electionName.value.trim();
  if(!election.name||!election.cargos.length){
    alert(txt[lang].configure);return;
  }
  currentCargo=0;showCargo();
}

function showCargo(){
  selected=[];
  showScreen("voting");
  const c=election.cargos[currentCargo];
  cargoTitle.innerText=c.cargo;
  candidates.innerHTML="";
  c.candidates.forEach((x,i)=>{
    const d=document.createElement("div");
    d.className="candidate";
    d.innerHTML=`<img src="${x.photo}"><p>${x.name}</p>`;
    d.onclick=()=>toggle(i,d);
    candidates.appendChild(d);
  });
}

function toggle(i,d){
  const c=election.cargos[currentCargo];
  if(selected.includes(i)){
    selected=selected.filter(x=>x!==i);d.classList.remove("selected");
  }else{
    if(selected.length>=c.max){alert(txt[lang].limit);return;}
    selected.push(i);d.classList.add("selected");
  }
}

function confirmVote(){
  selected.forEach(i=>election.cargos[currentCargo].candidates[i].votes++);
  currentCargo<election.cargos.length-1?(currentCargo++,showCargo()):showScreen("afterVote");
}

function nextVoter(){currentCargo=0;showCargo();}

function finishElection(){
  showScreen("results");
  resultContent.innerHTML=`<h3>${election.name}</h3>`;
  election.cargos.forEach(c=>{
    resultContent.innerHTML+=`<h4>${c.cargo}</h4>`;
    c.candidates.forEach(x=>{
      resultContent.innerHTML+=`<p>${x.name}: ${x.votes}</p>`;
    });
  });
}

function exportPDF(){
  const box=document.createElement("div");
  box.className="result-box";
  box.innerHTML=resultContent.innerHTML;
  document.body.appendChild(box);
  html2pdf().from(box).save().then(()=>box.remove());
}

function goToPayment(){window.open(PAYMENT_LINK,"_blank");}

/* ================== TEXTOS ================== */
const txt={
pt:{login:"Identifica√ß√£o",continue:"Continuar",config:"Configura√ß√£o",
election:"Nome da Elei√ß√£o",cargo:"Cargo",votes:"Votos",
names:"Arquivo de nomes (.txt)",photos:"Fotos",
add:"Adicionar Cargo",start:"Iniciar",
confirm:"Confirmar",confirmed:"Voto Confirmado",
next:"Novo Eleitor",finish:"Encerrar",
result:"Resultado",pdf:"Exportar PDF",
plan:"Plano Premium",planText:"Primeira elei√ß√£o gr√°tis.",
invalidEmail:"Informe um Gmail v√°lido",
fillAll:"Preencha tudo",configure:"Configure a elei√ß√£o",
limit:"Limite atingido"},
en:{login:"Login",continue:"Continue",config:"Setup",
election:"Election Name",cargo:"Position",votes:"Votes",
names:"Names file",photos:"Photos",
add:"Add Position",start:"Start",
confirm:"Confirm",confirmed:"Vote Confirmed",
next:"Next",finish:"Finish",
result:"Results",pdf:"Export PDF",
plan:"Premium Plan",planText:"First election is free.",
invalidEmail:"Enter a valid Gmail",
fillAll:"Fill all fields",configure:"Configure election",
limit:"Limit reached"},
es:{login:"Identificaci√≥n",continue:"Continuar",config:"Configuraci√≥n",
election:"Nombre",cargo:"Cargo",votes:"Votos",
names:"Archivo de nombres",photos:"Fotos",
add:"Agregar Cargo",start:"Iniciar",
confirm:"Confirmar",confirmed:"Voto Confirmado",
next:"Nuevo",finish:"Finalizar",
result:"Resultados",pdf:"Exportar PDF",
plan:"Plan Premium",planText:"Primera elecci√≥n gratis.",
invalidEmail:"Ingrese Gmail v√°lido",
fillAll:"Complete todo",configure:"Configure elecci√≥n",
limit:"L√≠mite alcanzado"}
};

function setLang(l){
  lang=l;localStorage.setItem("lang",l);
  tLogin.innerText=txt[l].login;
  btnContinue.innerText=txt[l].continue;
  tConfig.innerText=txt[l].config;
  electionName.placeholder=txt[l].election;
  cargoName.placeholder=txt[l].cargo;
  maxVotes.placeholder=txt[l].votes;
  lblNames.innerText=txt[l].names;
  lblPhotos.innerText=txt[l].photos;
  btnAddCargo.innerText=txt[l].add;
  btnStart.innerText=txt[l].start;
  btnConfirm.innerText=txt[l].confirm;
  tConfirmed.innerText=txt[l].confirmed;
  btnNext.innerText=txt[l].next;
  btnFinish.innerText=txt[l].finish;
  tResult.innerText=txt[l].result;
  btnPDF.innerText=txt[l].pdf;
  tPlan.innerText=txt[l].plan;
  tPlanText.innerHTML=txt[l].planText;
}
setLang(lang);
</script>

</body>
</html>
