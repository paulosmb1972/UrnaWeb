<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>UrnaWeb</title>
<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:0;
}
.screen{
  display:none;
  padding:20px;
  max-width:600px;
  margin:auto;
  background:#fff;
  margin-top:40px;
  border-radius:8px;
}
h2{text-align:center}
input,button{
  width:100%;
  padding:10px;
  margin:8px 0;
}
button{
  background:#0066cc;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{opacity:0.9}
.list-item{
  padding:8px;
  border-bottom:1px solid #ddd;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen" class="screen">
  <h2>Identificação</h2>
  <p>Informe seu Gmail para continuar</p>
  <input type="email" id="emailInput" placeholder="seuemail@gmail.com">
  <button onclick="confirmEmail()">Continuar</button>
</div>

<!-- PAGAMENTO -->
<div id="paymentScreen" class="screen">
  <h2>Pagamento necessário</h2>
  <p>Você já utilizou a eleição gratuita.</p>
  <p>Para criar novas eleições, realize o pagamento:</p>

  <a href="https://mpago.la/1VakcdN" target="_blank">
    <button>Pagar com PIX ou Cartão</button>
  </a>

  <button onclick="confirmPayment()">Já paguei</button>
</div>

<!-- SETUP -->
<div id="setupScreen" class="screen">
  <h2>Criar Eleição</h2>

  <input id="cargoNome" placeholder="Nome do Cargo">
  <button onclick="addCargo()">Adicionar Cargo</button>

  <div id="cargoList"></div>

  <button onclick="startVoting()">Iniciar Votação</button>
</div>

<!-- VOTAÇÃO -->
<div id="votingScreen" class="screen">
  <h2>Votação</h2>
  <div id="votingArea"></div>
  <button onclick="finishVoting()">Encerrar Votação</button>
</div>

<!-- RESULTADO -->
<div id="resultScreen" class="screen">
  <h2>Resultado</h2>
  <div id="resultArea"></div>
  <button onclick="newElection()">Nova Eleição</button>
</div>

<script>
let cargos = [];
let votos = {};

function showScreen(id){
  document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

/* LOGIN */
function confirmEmail(){
  const email = emailInput.value.trim();
  if(!email.endsWith("@gmail.com")){
    alert("Informe um Gmail válido.");
    return;
  }
  localStorage.setItem("urnaweb_email", email);

  if(localStorage.getItem("freeUsed_"+email)){
    showScreen("paymentScreen");
  }else{
    showScreen("setupScreen");
  }
}

/* PAGAMENTO */
function confirmPayment(){
  const email = localStorage.getItem("urnaweb_email");
  localStorage.removeItem("freeUsed_"+email);
  alert("Pagamento liberado!");
  showScreen("setupScreen");
}

/* SETUP */
function addCargo(){
  const nome = cargoNome.value.trim();
  if(!nome) return;

  cargos.push({nome:nome, candidatos:[]});
  cargoNome.value="";
  renderCargos();
}

function renderCargos(){
  cargoList.innerHTML="";
  cargos.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="list-item";
    div.innerHTML=`
      <strong>${c.nome}</strong><br>
      <input placeholder="Nome do candidato" id="cand_${i}">
      <button onclick="addCandidato(${i})">Adicionar Candidato</button>
      <div id="candList_${i}"></div>
    `;
    cargoList.appendChild(div);
  });
}

function addCandidato(i){
  const input=document.getElementById("cand_"+i);
  if(!input.value) return;
  cargos[i].candidatos.push(input.value);
  input.value="";
  renderCandidatos(i);
}

function renderCandidatos(i){
  const div=document.getElementById("candList_"+i);
  div.innerHTML="";
  cargos[i].candidatos.forEach(c=>{
    div.innerHTML+=`- ${c}<br>`;
  });
}

/* VOTAÇÃO */
function startVoting(){
  if(cargos.length===0){
    alert("Adicione ao menos um cargo.");
    return;
  }
  votos={};
  showScreen("votingScreen");
  renderVoting();
}

function renderVoting(){
  votingArea.innerHTML="";
  cargos.forEach(c=>{
    votingArea.innerHTML+=`<h3>${c.nome}</h3>`;
    c.candidatos.forEach(nome=>{
      votingArea.innerHTML+=`
        <button onclick="vote('${c.nome}','${nome}')">${nome}</button>
      `;
    });
  });
}

function vote(cargo,candidato){
  votos[cargo]=votos[cargo]||{};
  votos[cargo][candidato]=(votos[cargo][candidato]||0)+1;
  alert("Voto computado!");
}

/* RESULTADO */
function finishVoting(){
  const email = localStorage.getItem("urnaweb_email");
  if(!localStorage.getItem("freeUsed_"+email)){
    localStorage.setItem("freeUsed_"+email,"true");
  }

  showScreen("resultScreen");
  resultArea.innerHTML="";
  for(let cargo in votos){
    resultArea.innerHTML+=`<h3>${cargo}</h3>`;
    for(let cand in votos[cargo]){
      resultArea.innerHTML+=`${cand}: ${votos[cargo][cand]} votos<br>`;
    }
  }
}

function newElection(){
  cargos=[];
  votos={};
  showScreen("setupScreen");
}

/* INICIAL */
showScreen("loginScreen");
</script>

</body>
</html>
